---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all posts and projects, sorted by date (newest first)
const allPosts = (await getCollection('writing')).sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const allProjects = (await getCollection('projects')).sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Decorative emoticon - EASY TO CHANGE: Just replace the text below
// This appears at the top of the main content area
const decorativeEmoji = '૮・ﻌ・ა♡‧₊˚';
---

<BaseLayout title="Jimmy Liu — Portfolio & Resume"> 
  
  <!-- Decorative Element -->
  <div class="mb-6 text-2xl">
    {decorativeEmoji}
  </div>

  <!-- Introduction -->
  <div class="mb-12 max-w-3xl">
    <p class="mb-4 text-logic-text dark:text-brutal-dark-text">
      I am a [YOUR ROLE/TITLE] who [WHAT YOU DO]. Want to know more? <a href="/about" class="underline text-logic-link dark:text-brutal-dark-text">Read more about me</a>.
    </p>
    <p class="text-logic-text dark:text-brutal-dark-text">
      Like my work? <a href="/projects" class="underline text-logic-link dark:text-brutal-dark-text">View my projects</a>.
    </p>
  </div>

  <!-- Writings Section -->
  {allPosts.length > 0 && (
    <div class="mb-16">
      <p class="mb-4 text-sm text-logic-text dark:text-brutal-dark-text">
        Here's what I have for you so far:
      </p>
      
      <h2 class="text-3xl font-bold mb-8 text-logic-link dark:text-brutal-dark-text">Writings</h2>
      
      <div class="space-y-8">
        {allPosts.map(post => {
        const postDate = new Date(post.data.date);
        const isRecent = (Date.now() - postDate.getTime()) < 90 * 24 * 60 * 60 * 1000; // Within last 90 days
        const status = isRecent ? '(Recent)' : '';
        
        return (
          <div class="mb-8">
            <h3 class="text-xl font-bold mb-2">
              <a href={`/writing/${post.slug}`} class="underline text-logic-link dark:text-brutal-dark-text hover:opacity-70">
                {post.data.title}
              </a>
              {status && <span class="text-sm font-normal text-logic-text dark:text-brutal-dark-text"> {status}</span>}
            </h3>
            <p class="mb-3 text-logic-text dark:text-brutal-dark-text">
              {post.data.description}
            </p>
            <p class="text-sm text-logic-text dark:text-brutal-dark-text">
              <a href={`/writing/${post.slug}`} class="underline text-logic-link dark:text-brutal-dark-text">Read more</a>.
            </p>
          </div>
        );
      })}
      </div>
    </div>
  )}

  <!-- Projects Section (Optional - can be removed if not needed) -->
  {allProjects.length > 0 && (
    <div>
      <h2 class="text-3xl font-bold mb-8 text-logic-link dark:text-brutal-dark-text">Projects</h2>
      
      <div class="space-y-8">
        {allProjects.map(project => {
          const projectDate = new Date(project.data.date);
          const isRecent = (Date.now() - projectDate.getTime()) < 90 * 24 * 60 * 60 * 1000;
          const status = isRecent ? '(Recent)' : '(Available)';
          
          return (
            <div class="mb-8">
              <h3 class="text-xl font-bold mb-2">
                <a href={`/projects/${project.slug}`} class="underline text-logic-link dark:text-brutal-dark-text hover:opacity-70">
                  {project.data.title}
                </a>
                <span class="text-sm font-normal text-logic-text dark:text-brutal-dark-text"> ({status})</span>
              </h3>
              <p class="mb-3 text-logic-text dark:text-brutal-dark-text">
                {project.data.description}
              </p>
              <p class="text-sm text-logic-text dark:text-brutal-dark-text">
                {project.data.demoUrl && (
                  <>
                    <a href={project.data.demoUrl} target="_blank" rel="noopener" class="underline text-logic-link dark:text-brutal-dark-text">View demo</a>,{' '}
                  </>
                )}
                {project.data.githubUrl && (
                  <>
                    <a href={project.data.githubUrl} target="_blank" rel="noopener" class="underline text-logic-link dark:text-brutal-dark-text">view source</a>,{' '}
                  </>
                )}
                <a href={`/projects/${project.slug}`} class="underline text-logic-link dark:text-brutal-dark-text">read more</a>.
              </p>
            </div>
          );
        })}
      </div>
    </div>
  )}

</BaseLayout>
