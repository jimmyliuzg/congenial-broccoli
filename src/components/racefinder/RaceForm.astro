---
// src/components/racefinder/RaceForm.astro
// Split layout with inline sentence form and progressive reveal
---

<div
    id="race-form-container"
    class="h-screen flex flex-col lg:flex-row overflow-hidden bg-black"
>
    <!-- LEFT SIDE: Title Only (Larger, no subtitle) -->
    <div
        class="lg:w-2/5 flex flex-col justify-center p-8 md:p-12 lg:p-16 xl:p-20 bg-black relative"
    >
        <div class="max-w-lg">
            <div class="flex items-center gap-4 mb-6">
                <div class="w-12 h-1 bg-[#13F0FF]"></div>
                <span
                    class="text-[#13F0FF] font-mono text-xs tracking-[0.3em] uppercase"
                    >Race Discovery</span
                >
            </div>
            <h1
                class="text-6xl md:text-7xl lg:text-8xl xl:text-[9rem] font-black text-white leading-[0.85] tracking-tighter uppercase"
            >
                Find<br />Your<br />Next<br /><span class="text-[#FF13F0]"
                    >Race</span
                >
            </h1>
        </div>

        <!-- Decorative -->
        <div
            class="absolute bottom-8 left-8 hidden lg:flex items-center gap-3 text-white/20 text-sm"
        >
            <div
                class="w-8 h-8 rounded-full border border-current flex items-center justify-center"
            >
                <span class="text-xs">01</span>
            </div>
            <span class="font-mono uppercase tracking-widest">Racefinder</span>
        </div>
    </div>

    <!-- RIGHT SIDE: Inline Sentence Form -->
    <div
        class="lg:w-3/5 flex flex-col justify-center p-8 md:p-12 lg:p-16 xl:p-20 bg-[#0a0a0a] relative overflow-hidden"
    >
        <form id="find-race-form" class="max-w-2xl">
            <!-- Continuous inline sentence -->
            <div
                class="text-2xl md:text-3xl lg:text-4xl xl:text-5xl font-bold text-white leading-[1.8] md:leading-[2]"
            >
                <!-- Part 1: Always visible -->
                <span class="text-white/40"
                    >I am <span id="article-text">a</span>
                </span>
                <span class="select-wrapper">
                    <select
                        id="experience"
                        name="experienceLevel"
                        required
                        class="select-field placeholder-active appearance-none bg-transparent border-b-2 border-[#FF13F0] text-[#FF13F0] px-2 cursor-pointer hover:opacity-100 hover:border-white hover:text-white transition-all focus:outline-none min-w-[140px]"
                    >
                        <option value="" disabled selected class="bg-black"
                            >beginner</option
                        >
                        <option value="Beginner" class="bg-black"
                            >beginner</option
                        >
                        <option value="Intermediate" class="bg-black"
                            >intermediate</option
                        >
                        <option value="Advanced" class="bg-black"
                            >advanced</option
                        >
                    </select>
                </span>
                <span class="text-white/40"> runner </span>

                <!-- Part 2: Appears after experience selected -->
                <span
                    id="step-2"
                    class="inline opacity-0 transition-opacity duration-500"
                >
                    <span class="text-white/40">looking to run a </span>
                    <span class="select-wrapper">
                        <select
                            id="distance"
                            name="distance"
                            required
                            class="select-field placeholder-active appearance-none bg-transparent border-b-2 border-[#F0FF13] text-[#F0FF13] px-2 cursor-pointer hover:opacity-100 hover:border-white hover:text-white transition-all focus:outline-none min-w-[140px]"
                        >
                            <option value="" disabled selected class="bg-black"
                                >5K</option
                            >
                            <option value="5K" class="bg-black">5K</option>
                            <option value="10K" class="bg-black">10K</option>
                            <option value="Half Marathon" class="bg-black"
                                >half marathon</option
                            >
                            <option value="Marathon" class="bg-black"
                                >marathon</option
                            >
                        </select>
                    </span>
                </span>

                <!-- Part 3: "in [location]" - appears after distance -->
                <span
                    id="step-3"
                    class="inline opacity-0 transition-opacity duration-500"
                >
                    <span class="text-white/40"> in </span>
                    <input
                        type="text"
                        id="location"
                        name="location"
                        placeholder="any city"
                        required
                        class="inline bg-transparent border-b-2 border-white/30 text-white placeholder-white/30 px-1 focus:outline-none focus:border-[#13F0FF] focus:text-[#13F0FF] transition-colors w-28 md:w-36 lg:w-44"
                    />
                </span>

                <!-- Part 4: "on [type]" - appears after location has text -->
                <span
                    id="step-4"
                    class="inline opacity-0 transition-opacity duration-500"
                >
                    <span class="text-white/40"> on </span>
                    <span class="select-wrapper">
                        <select
                            id="type"
                            name="type"
                            required
                            class="select-field placeholder-active appearance-none bg-transparent border-b-2 border-[#13F0FF] text-[#13F0FF] px-2 cursor-pointer hover:opacity-100 hover:border-white hover:text-white transition-all focus:outline-none min-w-[100px]"
                        >
                            <option value="" disabled selected class="bg-black"
                                >road</option
                            >
                            <option value="Road" class="bg-black">road</option>
                            <option value="Trail" class="bg-black">trail</option
                            >
                        </select>
                    </span>
                </span>

                <!-- Part 5: Timeline + Button - appears after type selected -->
                <span
                    id="step-5"
                    class="inline opacity-0 transition-opacity duration-500"
                >
                    <span class="text-white/40"> within </span>
                    <input
                        type="number"
                        id="timeline"
                        name="timelineInMonths"
                        placeholder="6"
                        min="1"
                        max="24"
                        required
                        class="inline bg-transparent border-b-2 border-white text-white text-center px-1 focus:outline-none focus:border-[#F0FF13] focus:text-[#F0FF13] transition-colors w-10 md:w-12 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"
                    />
                    <span class="text-white/40"> months</span>
                    <span class="text-white/40">.</span>
                </span>
            </div>

            <!-- Submit Button - appears after timeline filled -->
            <div
                id="submit-container"
                class="mt-10 opacity-0 translate-y-4 transition-all duration-500"
            >
                <button
                    type="submit"
                    id="submit-btn"
                    aria-label="Find races"
                    class="group flex items-center gap-4 px-8 py-4 bg-[#FF13F0] text-black font-bold text-lg uppercase tracking-wide hover:bg-[#13F0FF] hover:scale-105 active:scale-95 transition-all duration-200"
                >
                    <span>Find My Race</span>
                    <svg
                        class="w-6 h-6 group-hover:translate-x-2 transition-transform"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="3"
                            d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                </button>
            </div>

            <!-- Progress dots -->
            <div id="progress-bar" class="mt-8 flex gap-2">
                <div
                    class="progress-dot w-2 h-2 rounded-full bg-[#FF13F0] transition-colors duration-300"
                >
                </div>
                <div
                    class="progress-dot w-2 h-2 rounded-full bg-white/20 transition-colors duration-300"
                >
                </div>
                <div
                    class="progress-dot w-2 h-2 rounded-full bg-white/20 transition-colors duration-300"
                >
                </div>
                <div
                    class="progress-dot w-2 h-2 rounded-full bg-white/20 transition-colors duration-300"
                >
                </div>
                <div
                    class="progress-dot w-2 h-2 rounded-full bg-white/20 transition-colors duration-300"
                >
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Results Container -->
<div id="results-container" class="hidden">
    <!-- Will be populated by JS -->
</div>

<!-- Warning Modal -->
<dialog
    id="warning-modal"
    class="backdrop:bg-black/90 p-0 bg-transparent max-w-lg w-full mx-auto"
>
    <div class="bg-[#F0FF13] p-8 md:p-12">
        <div class="flex items-center gap-3 mb-6">
            <div class="w-3 h-3 rounded-full bg-black animate-pulse"></div>
            <span class="text-black font-mono text-sm tracking-widest uppercase"
                >Warning</span
            >
        </div>
        <h3
            class="text-4xl md:text-5xl font-black text-black mb-6 leading-tight uppercase tracking-tight"
        >
            Hold up.
        </h3>
        <p
            id="warning-message"
            class="text-xl font-medium text-black/80 mb-8 leading-relaxed"
        >
            That's a tight timeline.
        </p>
        <div class="flex gap-4">
            <button
                id="modal-cancel"
                class="flex-1 py-4 bg-black text-white font-bold text-lg tracking-wide hover:bg-white hover:text-black transition-colors uppercase"
                >Adjust</button
            >
            <button
                id="modal-confirm"
                class="flex-1 py-4 bg-[#FF13F0] text-black font-bold text-lg tracking-wide hover:bg-[#13F0FF] transition-colors uppercase"
                >Send it →</button
            >
        </div>
    </div>
</dialog>

<script>
    // === Progressive Reveal Logic ===
    const progressDots = document.querySelectorAll(".progress-dot");
    const colors = ["#FF13F0", "#F0FF13", "#13F0FF", "#FF13F0", "#F0FF13"];

    function showStep(stepId: string, dotIndex: number) {
        const el = document.getElementById(stepId);
        if (el && el.classList.contains("opacity-0")) {
            el.classList.remove("opacity-0");
            el.classList.add("opacity-100");

            // Update progress dot
            if (progressDots[dotIndex]) {
                progressDots[dotIndex].classList.remove("bg-white/20");
                progressDots[dotIndex].classList.add(
                    `bg-[${colors[dotIndex]}]`,
                );
            }
        }
    }

    function showSubmit() {
        const container = document.getElementById("submit-container");
        if (container) {
            container.classList.remove("opacity-0", "translate-y-4");
            container.classList.add("opacity-100", "translate-y-0");
        }
    }

    // Step 1 -> Step 2
    document.getElementById("experience")?.addEventListener("change", (e) => {
        const target = e.target as HTMLSelectElement;
        if (target.value) {
            showStep("step-2", 1);
            target.classList.remove("placeholder-active");
            target.classList.add("value-selected");

            // Update article: "a" for beginner, "an" for intermediate/advanced
            const articleEl = document.getElementById("article-text");
            if (articleEl) {
                const needsAn = ["Intermediate", "Advanced"].includes(
                    target.value,
                );
                articleEl.textContent = needsAn ? "an" : "a";
            }
        }
    });

    // Step 2 -> Step 3
    document.getElementById("distance")?.addEventListener("change", (e) => {
        const target = e.target as HTMLSelectElement;
        if (target.value) {
            showStep("step-3", 2);
            target.classList.remove("placeholder-active");
            target.classList.add("value-selected");
        }
    });

    // Step 3 (location input) -> Step 4
    document.getElementById("location")?.addEventListener("input", (e) => {
        const target = e.target as HTMLInputElement;
        if (target.value.length >= 2) {
            showStep("step-4", 3);
        }
    });

    // Step 4 -> Step 5
    document.getElementById("type")?.addEventListener("change", (e) => {
        const target = e.target as HTMLSelectElement;
        if (target.value) {
            showStep("step-5", 4);
            target.classList.remove("placeholder-active");
            target.classList.add("value-selected");
        }
    });

    // Timeline -> Show Submit
    document.getElementById("timeline")?.addEventListener("input", (e) => {
        const target = e.target as HTMLInputElement;
        if (target.value) {
            showSubmit();
        }
    });

    // === Slow Cycling Placeholder Animation ===
    // Cycles through options every 2.5 seconds until user selects
    const cycleConfig: Record<string, { selectId: string; options: string[] }> =
        {
            experience: {
                selectId: "experience",
                options: ["beginner", "intermediate", "advanced"],
            },
            distance: {
                selectId: "distance",
                options: ["5K", "10K", "half marathon", "marathon"],
            },
            type: { selectId: "type", options: ["road", "trail"] },
        };

    Object.values(cycleConfig).forEach(({ selectId, options }) => {
        const selectEl = document.getElementById(selectId) as HTMLSelectElement;
        if (!selectEl) return;

        const placeholderOption = selectEl.options[0];
        let idx = 0;
        let intervalId: number;
        let isActive = true;
        let isPaused = false;

        // Store original placeholder text for when dropdown opens
        const openPlaceholders: Record<string, string> = {
            experience: "choose level",
            distance: "choose distance",
            type: "choose type",
        };

        // Breathing animation: fade out -> change text -> fade in
        function breatheAndCycle() {
            if (!isActive || isPaused || selectEl.value) return;

            // Phase 1: Breathe out (fade out)
            selectEl.classList.add("breathing-out");

            // Phase 2: Change text at peak of exhale (after 300ms)
            setTimeout(() => {
                if (!isActive || isPaused || selectEl.value) return;
                idx = (idx + 1) % options.length;
                placeholderOption.text = options[idx];

                // Update article for experience dropdown during cycling
                if (selectId === "experience") {
                    const articleEl = document.getElementById("article-text");
                    if (articleEl) {
                        const needsAn = ["intermediate", "advanced"].includes(
                            options[idx],
                        );
                        articleEl.textContent = needsAn ? "an" : "a";
                    }
                }

                // Phase 3: Breathe in (fade back in)
                selectEl.classList.remove("breathing-out");
                selectEl.classList.add("breathing-in");

                // Reset for next cycle
                setTimeout(() => {
                    selectEl.classList.remove("breathing-in");
                }, 300);
            }, 300);
        }

        function pauseCycling() {
            isPaused = true;
            selectEl.classList.remove("breathing-out", "breathing-in");
            // Show distinct instruction text when dropdown is open
            placeholderOption.text = openPlaceholders[selectId] || "choose...";
            // Add focused state styling
            selectEl.classList.add("dropdown-open");
        }

        function resumeCycling() {
            if (selectEl.value) return; // Don't resume if value selected
            isPaused = false;
            selectEl.classList.remove("dropdown-open");
            // Reset to current cycle position
            placeholderOption.text = options[idx];
        }

        function stopCycling() {
            isActive = false;
            isPaused = false;
            clearInterval(intervalId);
            selectEl.classList.remove(
                "breathing-out",
                "breathing-in",
                "dropdown-open",
            );
            if (selectEl.value) {
                placeholderOption.style.display = "none";
            }
        }

        // Start with first option
        placeholderOption.text = options[0];

        // Cycle every 1.8 seconds
        intervalId = setInterval(breatheAndCycle, 1800) as unknown as number;

        // Pause cycling when dropdown opens (focus/click)
        selectEl.addEventListener("focus", pauseCycling);
        selectEl.addEventListener("mousedown", pauseCycling);

        // Resume cycling when dropdown closes without selection
        selectEl.addEventListener("blur", () => {
            if (selectEl.value) {
                stopCycling();
            } else {
                resumeCycling();
            }
        });

        // Stop cycling permanently when value selected
        selectEl.addEventListener("change", stopCycling);
    });

    // === Form Submission ===
    const form = document.getElementById("find-race-form");
    const formContainer = document.getElementById("race-form-container");
    const resultsContainer = document.getElementById("results-container");
    const warningModal = document.getElementById(
        "warning-modal",
    ) as HTMLDialogElement;
    const warningMsg = document.getElementById("warning-message");
    const modalCancel = document.getElementById("modal-cancel");
    const modalConfirm = document.getElementById("modal-confirm");

    let pendingData: any = null;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target as HTMLFormElement);
        const data: any = Object.fromEntries(formData.entries());
        data.timelineInMonths = Number(data.timelineInMonths);

        console.log("[Racefinder] Browser time:", new Date().toISOString());
        console.log("[Racefinder] Search criteria:", data);

        // Validation warnings
        const isBeginner = data.experienceLevel === "Beginner";
        const isMarathon = data.distance === "Marathon";
        const isHalf = data.distance === "Half Marathon";
        const timeline = data.timelineInMonths;

        let needsWarning = false;
        if (isBeginner && isMarathon && timeline <= 3) {
            warningMsg!.textContent =
                "A marathon in " +
                timeline +
                " month(s)? Most training plans need 16-20 weeks.";
            needsWarning = true;
        } else if (isBeginner && isHalf && timeline <= 2) {
            warningMsg!.textContent =
                "A half marathon in " +
                timeline +
                " month(s)? Consider 8-12 weeks of training.";
            needsWarning = true;
        }

        if (needsWarning) {
            pendingData = data;
            warningModal.showModal();
            return;
        }

        await fetchAndShowResults(data);
    });

    modalCancel?.addEventListener("click", () => {
        warningModal.close();
        pendingData = null;
    });

    modalConfirm?.addEventListener("click", async () => {
        warningModal.close();
        if (pendingData) {
            await fetchAndShowResults(pendingData);
        }
    });

    async function fetchAndShowResults(data: any) {
        const btn = document.getElementById("submit-btn");
        const originalHTML = btn!.innerHTML;
        btn!.innerHTML = "<span>Searching...</span>";
        btn!.setAttribute("disabled", "true");
        btn!.classList.add("animate-pulse");

        try {
            const res = await fetch("/api/races/search", {
                method: "POST",
                body: JSON.stringify(data),
                headers: { "Content-Type": "application/json" },
            });

            if (!res.ok) {
                throw new Error(`API returned ${res.status}`);
            }

            const results = await res.json();
            console.log("[Racefinder] Results:", results);

            if (results.error) {
                throw new Error(results.error);
            }

            renderResults(results, data);
            formContainer!.style.display = "none";
            resultsContainer!.classList.remove("hidden");
            window.scrollTo(0, 0);
        } catch (err) {
            console.error("[Racefinder] Error:", err);
            alert("Something went wrong: " + (err as Error).message);
            btn!.innerHTML = originalHTML;
            btn!.removeAttribute("disabled");
            btn!.classList.remove("animate-pulse");
        }
    }

    function renderResults(results: any, query: any) {
        const topMatch = results?.topMatch || null;
        const alternatives = results?.alternatives || [];
        const allRaces = topMatch ? [topMatch, ...alternatives] : alternatives;
        let html = "";

        if (!topMatch && alternatives.length === 0) {
            html = `
                <div class="min-h-screen flex flex-col justify-center p-8 md:p-16 lg:p-24 bg-black">
                    <div class="max-w-4xl">
                        <div class="flex items-center gap-4 mb-8">
                            <div class="w-16 h-1 bg-[#FF13F0]"></div>
                            <span class="text-[#FF13F0] font-mono text-sm tracking-[0.3em] uppercase">No matches</span>
                        </div>
                        <h2 class="text-5xl md:text-7xl font-black text-white leading-tight mb-8 tracking-tighter uppercase">
                            No ${query.distance || ""} races<br/>found in <span class="text-[#13F0FF]">${query.location || "your area"}</span>
                        </h2>
                        <p class="text-xl text-white/60 mb-12 max-w-xl">Try expanding your timeline or adjusting your location.</p>
                        <button onclick="window.location.reload()" class="inline-flex items-center gap-4 px-8 py-4 bg-white text-black font-bold uppercase tracking-wide hover:bg-[#F0FF13] transition-colors">
                            <svg class="w-5 h-5 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                            </svg>
                            <span>Try Again</span>
                        </button>
                    </div>
                </div>
            `;
        } else if (topMatch) {
            html += `
                <div class="min-h-screen flex flex-col justify-between p-8 md:p-16 lg:p-24 bg-[#FF13F0] relative overflow-hidden">
                    <div class="absolute -right-20 top-1/2 -translate-y-1/2 text-[30rem] font-black text-black/5 leading-none select-none hidden xl:block pointer-events-none">01</div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center gap-4 mb-12">
                            <div class="w-16 h-1 bg-black"></div>
                            <span class="text-black font-mono text-sm tracking-[0.3em] uppercase">Top Pick</span>
                        </div>
                        
                        <div class="flex flex-wrap gap-3 mb-6">
                            <span class="px-4 py-2 bg-black text-white text-sm font-bold uppercase tracking-wider">${topMatch.distance}</span>
                            <span class="px-4 py-2 bg-[#13F0FF] text-black text-sm font-bold uppercase tracking-wider">${topMatch.type}</span>
                        </div>
                        
                        <h2 class="text-5xl md:text-7xl lg:text-8xl font-black text-black leading-[0.9] tracking-tighter uppercase mb-8 max-w-4xl">
                            ${topMatch.name}
                        </h2>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12 max-w-4xl">
                            <div class="bg-black/10 p-4 md:p-6">
                                <p class="text-black/50 text-xs font-mono uppercase tracking-widest mb-1">Date</p>
                                <p class="text-lg md:text-2xl font-black text-black">${new Date(topMatch.date).toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" })}</p>
                            </div>
                            <div class="bg-black/10 p-4 md:p-6">
                                <p class="text-black/50 text-xs font-mono uppercase tracking-widest mb-1">Location</p>
                                <p class="text-lg md:text-2xl font-black text-black">${topMatch.location.split(",")[0]}</p>
                            </div>
                            <div class="bg-black/10 p-4 md:p-6">
                                <p class="text-black/50 text-xs font-mono uppercase tracking-widest mb-1">Elevation</p>
                                <p class="text-lg md:text-2xl font-black text-black">${topMatch.elevationGain?.toLocaleString() || 0} ft</p>
                            </div>
                            <div class="bg-black/10 p-4 md:p-6">
                                <p class="text-black/50 text-xs font-mono uppercase tracking-widest mb-1">Entry</p>
                                <p class="text-lg md:text-2xl font-black text-black">$${topMatch.cost}</p>
                            </div>
                        </div>
                    </div>

                    <div class="relative z-10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6">
                        <a href="${topMatch.url}" target="_blank" 
                            class="group inline-flex items-center gap-4 px-8 py-5 bg-black text-white text-xl font-bold uppercase tracking-wide hover:bg-[#13F0FF] hover:text-black transition-all">
                            <span>Register Now</span>
                            <svg class="w-6 h-6 group-hover:translate-x-2 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                            </svg>
                        </a>
                        ${
                            allRaces.length > 1
                                ? `
                        <div class="text-black font-bold flex items-center gap-2 animate-bounce">
                            <span>Scroll for ${allRaces.length - 1} more</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                            </svg>
                        </div>
                        `
                                : ""
                        }
                    </div>
                </div>
            `;
        }

        // Full list
        if (allRaces.length > 0) {
            html += `
                <div class="p-8 md:p-16 lg:p-24 bg-black min-h-screen">
                    <div class="flex items-center gap-4 mb-12">
                        <div class="w-16 h-1 bg-[#13F0FF]"></div>
                        <span class="text-[#13F0FF] font-mono text-sm tracking-[0.3em] uppercase">All ${allRaces.length} Matches</span>
                    </div>
                    <div class="space-y-4 max-w-5xl">
            `;

            allRaces.forEach((race: any, index: number) => {
                const isTop = index === 0 && topMatch;
                html += `
                    <div class="group flex flex-col md:flex-row md:items-center justify-between gap-4 p-6 border border-white/10 hover:border-[#FF13F0] hover:bg-white/5 transition-all ${isTop ? "bg-white/5 border-[#FF13F0]" : ""}">
                        <div class="flex items-start gap-4">
                            <span class="text-2xl font-black text-white/20 font-mono w-8">${String(index + 1).padStart(2, "0")}</span>
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <h4 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight group-hover:text-[#FF13F0] transition-colors">${race.name}</h4>
                                    ${isTop ? '<span class="px-2 py-0.5 bg-[#FF13F0] text-black text-xs font-bold uppercase">Top</span>' : ""}
                                </div>
                                <p class="text-white/50 text-sm">${race.location} • ${race.distance} • ${race.type}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-6 md:gap-8 pl-12 md:pl-0">
                            <div class="text-right">
                                <p class="text-white font-bold">${new Date(race.date).toLocaleDateString("en-US", { month: "short", day: "numeric" })}</p>
                                <p class="text-white/40 text-xs">$${race.cost}</p>
                            </div>
                            <a href="${race.url}" target="_blank" 
                                class="px-4 py-2 border border-white/20 text-white text-sm font-bold uppercase tracking-wider hover:bg-white hover:text-black transition-all whitespace-nowrap">
                                Details →
                            </a>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                    <div class="mt-16 text-center">
                        <button onclick="window.location.reload()" class="inline-flex items-center gap-3 text-white/60 hover:text-white transition-colors font-bold">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            <span>New Search</span>
                        </button>
                    </div>
                </div>
            `;
        }

        resultsContainer!.innerHTML = html;
    }
</script>

<style>
    select {
        text-align-last: left;
    }
    select option {
        background: black;
        color: white;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    input[type="number"] {
        -moz-appearance: textfield;
    }
    /* Select field styling */
    .select-wrapper {
        position: relative;
        display: inline-block;
    }

    /* Placeholder state: slightly faded text only */
    .select-field.placeholder-active {
        color: inherit;
        opacity: 0.65;
        transition: opacity 0.3s ease;
    }

    .select-field.placeholder-active:hover {
        opacity: 1;
    }

    /* Breathing animation phases - text only, not underline */
    .select-field.breathing-out {
        opacity: 0.3 !important;
        transition: opacity 0.3s ease-out;
    }

    .select-field.breathing-in {
        opacity: 0.7;
        transition: opacity 0.3s ease-in;
    }

    /* When value is selected: full opacity */
    .select-field.value-selected {
        opacity: 1 !important;
    }

    /* Dropdown open state: full visibility, white border */
    .select-field.dropdown-open {
        opacity: 1 !important;
        border-color: white !important;
        color: white !important;
    }

    /* Focus ring for accessibility */
    .select-field:focus {
        outline: none;
        opacity: 1;
    }

    /* Hover state enhancement */
    .select-field:hover:not(.value-selected) {
        opacity: 0.9;
        cursor: pointer;
    }
</style>
